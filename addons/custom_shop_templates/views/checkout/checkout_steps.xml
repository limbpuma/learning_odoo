<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
    ═══════════════════════════════════════════════════════════════════════════
    CHECKOUT MULTI-STEP - Complete checkout flow template
    ═══════════════════════════════════════════════════════════════════════════
    Flow: cart → address → shipping → payment → notes → confirmation

    Routes:
    - /shop/checkout?step=address  → Shows billing/shipping address forms
    - /shop/checkout?step=shipping → Shows shipping method selection
    - /shop/payment                → Shows payment method selection
    - /shop/checkout/notes         → Shows order notes + terms acceptance

    Controller: custom_shop_templates.controllers.checkout.TTSCheckout
    ═══════════════════════════════════════════════════════════════════════════
    -->
    <data>
        <!-- Combined Checkout Template (Address + Shipping Steps) -->
        <template id="checkout_steps_tts" inherit_id="website_sale.checkout" name="TTS Checkout Steps">
            <!-- Replace default checkout content -->
            <xpath expr="//div[@id='shop_checkout']" position="replace">
                <div id="shop_checkout" class="tts-checkout-steps">

                    <!-- ===============================================================
                         STEP 1: ADDRESS (Billing + Shipping)
                         =============================================================== -->
                    <t t-if="current_step == 'address'">
                        <div class="tts-checkout-address">
                            <!-- Address Form -->
                            <form method="POST" action="/shop/checkout/address" class="tts-checkout-address-form" id="checkout-address-form">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                                <!-- Billing Address Section -->
                                <div class="tts-checkout-billing-address">
                                    <h2 class="tts-checkout-address-title">Billing Address</h2>

                                    <!-- First Name + Last Name (2 columns) -->
                                    <div class="tts-checkout-form-row tts-checkout-form-row-2col">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="billing_first_name">First name</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="billing_first_name"
                                                       name="billing_first_name"
                                                       class="tts-checkout-form-input"
                                                       placeholder="John"
                                                       t-att-value="website_sale_order.partner_id.name.split()[0] if website_sale_order.partner_id.name else ''"
                                                       required="required"/>
                                            </div>
                                        </div>
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="billing_last_name">Last name</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="billing_last_name"
                                                       name="billing_last_name"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Doe"
                                                       t-att-value="' '.join(website_sale_order.partner_id.name.split()[1:]) if website_sale_order.partner_id.name and len(website_sale_order.partner_id.name.split()) > 1 else ''"
                                                       required="required"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Company Name (Optional) -->
                                    <div class="tts-checkout-form-row">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="company_name">
                                                Company name
                                                <span class="tts-checkout-form-label-optional">Optional</span>
                                            </label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="company_name"
                                                       name="company_name"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Company Inc."
                                                       t-att-value="website_sale_order.partner_id.company_name or ''"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- VAT-ID (Optional) -->
                                    <div class="tts-checkout-form-row">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="vat">
                                                VAT-ID
                                                <span class="tts-checkout-form-label-optional">Optional</span>
                                            </label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="vat"
                                                       name="vat"
                                                       class="tts-checkout-form-input"
                                                       placeholder="DE123456789"
                                                       t-att-value="website_sale_order.partner_id.vat or ''"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Address 1 -->
                                    <div class="tts-checkout-form-row">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="billing_street">Address 1</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="billing_street"
                                                       name="billing_street"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Street name and house number"
                                                       t-att-value="website_sale_order.partner_id.street or ''"
                                                       required="required"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Address 2 (Optional) -->
                                    <div class="tts-checkout-form-row">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="billing_street2">
                                                Address 2
                                                <span class="tts-checkout-form-label-optional">Optional</span>
                                            </label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="billing_street2"
                                                       name="billing_street2"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Apartment, suite, unit, etc."
                                                       t-att-value="website_sale_order.partner_id.street2 or ''"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Postcode/ZIP + City (2 columns) -->
                                    <div class="tts-checkout-form-row tts-checkout-form-row-2col">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="billing_zip">Postcode / ZIP</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="billing_zip"
                                                       name="billing_zip"
                                                       class="tts-checkout-form-input"
                                                       placeholder="10115"
                                                       t-att-value="website_sale_order.partner_id.zip or ''"
                                                       required="required"/>
                                            </div>
                                        </div>
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="billing_city">City</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="billing_city"
                                                       name="billing_city"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Berlin"
                                                       t-att-value="website_sale_order.partner_id.city or ''"
                                                       required="required"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- State + Country (2 columns) -->
                                    <div class="tts-checkout-form-row tts-checkout-form-row-2col">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="billing_state_id">
                                                State
                                                <span class="tts-checkout-form-label-optional">Optional</span>
                                            </label>
                                            <div class="tts-input-wrapper">
                                                <select id="billing_state_id" name="billing_state_id" class="tts-checkout-form-select">
                                                    <option value="">Select state</option>
                                                    <t t-foreach="states" t-as="state">
                                                        <option t-att-value="state.id"
                                                                t-att-selected="'selected' if website_sale_order.partner_id.state_id and website_sale_order.partner_id.state_id.id == state.id else None"
                                                                t-esc="state.name"/>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="billing_country_id">Country</label>
                                            <div class="tts-input-wrapper">
                                                <select id="billing_country_id" name="billing_country_id" class="tts-checkout-form-select" required="required">
                                                    <t t-foreach="countries" t-as="country">
                                                        <option t-att-value="country.id"
                                                                t-att-selected="'selected' if website_sale_order.partner_id.country_id and website_sale_order.partner_id.country_id.id == country.id else None"
                                                                t-esc="country.name"/>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Phone -->
                                    <div class="tts-checkout-form-row">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="phone">Phone</label>
                                            <div class="tts-input-wrapper">
                                                <input type="tel"
                                                       id="phone"
                                                       name="phone"
                                                       class="tts-checkout-form-input"
                                                       placeholder="+49 123 456789"
                                                       t-att-value="website_sale_order.partner_id.phone or ''"
                                                       required="required"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Checkbox: My shipping address is the same -->
                                    <div class="tts-checkout-form-row">
                                        <label class="tts-shipping-checkbox" onclick="toggleShippingAddress()">
                                            <input type="checkbox"
                                                   id="shipping_same"
                                                   name="shipping_same"
                                                   value="1"
                                                   checked="checked"
                                                   class="tts-checkbox"
                                                   onclick="toggleShippingAddress()"/>
                                            <img id="shippingCheckboxIcon"
                                                 class="tts-checkbox-icon"
                                                 src="/custom_shop_templates/static/src/img/icons/checkbox-checked.svg"
                                                 alt="Checkbox"/>
                                            <span class="tts-checkbox-label">My shipping address is the same</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Shipping Address Section (Hidden by default) -->
                                <div class="tts-checkout-shipping-address">
                                    <h2 class="tts-checkout-address-title">Shipping Address</h2>

                                    <!-- First Name + Last Name -->
                                    <div class="tts-checkout-form-row tts-checkout-form-row-2col">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="shipping_first_name">First name</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="shipping_first_name"
                                                       name="shipping_first_name"
                                                       class="tts-checkout-form-input"
                                                       placeholder="John"
                                                       t-att-value="website_sale_order.partner_shipping_id.name.split()[0] if website_sale_order.partner_shipping_id.name else ''"/>
                                            </div>
                                        </div>
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="shipping_last_name">Last name</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="shipping_last_name"
                                                       name="shipping_last_name"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Doe"
                                                       t-att-value="' '.join(website_sale_order.partner_shipping_id.name.split()[1:]) if website_sale_order.partner_shipping_id.name and len(website_sale_order.partner_shipping_id.name.split()) > 1 else ''"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Address 1 -->
                                    <div class="tts-checkout-form-row">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="shipping_street">Address 1</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="shipping_street"
                                                       name="shipping_street"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Street name and house number"
                                                       t-att-value="website_sale_order.partner_shipping_id.street or ''"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Address 2 (Optional) -->
                                    <div class="tts-checkout-form-row">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="shipping_street2">
                                                Address 2
                                                <span class="tts-checkout-form-label-optional">Optional</span>
                                            </label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="shipping_street2"
                                                       name="shipping_street2"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Apartment, suite, unit, etc."
                                                       t-att-value="website_sale_order.partner_shipping_id.street2 or ''"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Postcode/ZIP + City -->
                                    <div class="tts-checkout-form-row tts-checkout-form-row-2col">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="shipping_zip">Postcode / ZIP</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="shipping_zip"
                                                       name="shipping_zip"
                                                       class="tts-checkout-form-input"
                                                       placeholder="10115"
                                                       t-att-value="website_sale_order.partner_shipping_id.zip or ''"/>
                                            </div>
                                        </div>
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="shipping_city">City</label>
                                            <div class="tts-input-wrapper">
                                                <input type="text"
                                                       id="shipping_city"
                                                       name="shipping_city"
                                                       class="tts-checkout-form-input"
                                                       placeholder="Berlin"
                                                       t-att-value="website_sale_order.partner_shipping_id.city or ''"/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- State + Country -->
                                    <div class="tts-checkout-form-row tts-checkout-form-row-2col">
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="shipping_state_id">
                                                State
                                                <span class="tts-checkout-form-label-optional">Optional</span>
                                            </label>
                                            <div class="tts-input-wrapper">
                                                <select id="shipping_state_id" name="shipping_state_id" class="tts-checkout-form-select">
                                                    <option value="">Select state</option>
                                                    <t t-foreach="states" t-as="state">
                                                        <option t-att-value="state.id"
                                                                t-att-selected="'selected' if website_sale_order.partner_shipping_id.state_id and website_sale_order.partner_shipping_id.state_id.id == state.id else None"
                                                                t-esc="state.name"/>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="tts-checkout-form-group">
                                            <label class="tts-checkout-form-label" for="shipping_country_id">Country</label>
                                            <div class="tts-input-wrapper">
                                                <select id="shipping_country_id" name="shipping_country_id" class="tts-checkout-form-select">
                                                    <t t-foreach="countries" t-as="country">
                                                        <option t-att-value="country.id"
                                                                t-att-selected="'selected' if website_sale_order.partner_shipping_id.country_id and website_sale_order.partner_shipping_id.country_id.id == country.id else None"
                                                                t-esc="country.name"/>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Continue Button -->
                                <div class="tts-checkout-form-row">
                                    <div class="tts-checkout-button-wrapper">
                                        <button type="submit" class="tts-checkout-button">Continue to Shipping</button>
                                    </div>
                                </div>
                            </form>

                            <script type="text/javascript">
                                // Toggle shipping address visibility
                                function toggleShippingAddress() {
                                    const checkbox = document.getElementById('shipping_same');
                                    const checkboxIcon = document.getElementById('shippingCheckboxIcon');
                                    const shippingSection = document.querySelector('.tts-checkout-shipping-address');

                                    if (checkbox.checked) {
                                        shippingSection.classList.add('hidden');
                                        checkboxIcon.src = '/custom_shop_templates/static/src/img/icons/checkbox-checked.svg';
                                    } else {
                                        shippingSection.classList.remove('hidden');
                                        checkboxIcon.src = '/custom_shop_templates/static/src/img/icons/checkbox.svg';
                                    }
                                }

                                // Initialize on page load
                                document.addEventListener('DOMContentLoaded', function() {
                                    toggleShippingAddress();
                                });
                            </script>
                        </div>
                    </t>

                    <!-- ===============================================================
                         STEP 2: SHIPPING METHOD SELECTION
                         =============================================================== -->
                    <t t-elif="current_step == 'shipping'">
                        <div class="checkout_custom_step_shipping">

                            <!-- Address Summary Card -->
                            <div class="tts-address-summary">
                                <div class="tts-address-summary-header">
                                    <h3 class="tts-address-summary-title">Address</h3>
                                    <a href="/shop/checkout?step=address" class="tts-address-edit-link">
                                        <span>edit</span>
                                        <svg class="tts-icon-edit" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <path d="M11.3333 2L14 4.66667L5.33333 13.3333H2.66667V10.6667L11.3333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                </div>

                                <div class="tts-address-summary-content">
                                    <!-- Billing Address -->
                                    <div class="tts-address-column">
                                        <h4 class="tts-address-column-title">Billing Address</h4>
                                        <div class="tts-address-text">
                                            <t t-if="website_sale_order.partner_id.company_name">
                                                <t t-esc="website_sale_order.partner_id.company_name"/><br/>
                                            </t>
                                            <t t-esc="website_sale_order.partner_id.name"/><br/>
                                            <t t-esc="website_sale_order.partner_id.street"/><br/>
                                            <t t-if="website_sale_order.partner_id.street2">
                                                <t t-esc="website_sale_order.partner_id.street2"/><br/>
                                            </t>
                                            <t t-esc="website_sale_order.partner_id.zip"/> <t t-esc="website_sale_order.partner_id.city"/>
                                        </div>
                                    </div>

                                    <!-- Shipping Address -->
                                    <div class="tts-address-column">
                                        <h4 class="tts-address-column-title">Shipping Address</h4>
                                        <div class="tts-address-text">
                                            <t t-if="website_sale_order.partner_shipping_id.id != website_sale_order.partner_id.id">
                                                <t t-if="website_sale_order.partner_shipping_id.company_name">
                                                    <t t-esc="website_sale_order.partner_shipping_id.company_name"/><br/>
                                                </t>
                                                <t t-esc="website_sale_order.partner_shipping_id.name"/><br/>
                                                <t t-esc="website_sale_order.partner_shipping_id.street"/><br/>
                                                <t t-if="website_sale_order.partner_shipping_id.street2">
                                                    <t t-esc="website_sale_order.partner_shipping_id.street2"/><br/>
                                                </t>
                                                <t t-esc="website_sale_order.partner_shipping_id.zip"/> <t t-esc="website_sale_order.partner_shipping_id.city"/>
                                            </t>
                                            <t t-else="">
                                                Same as billing address
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Shipping Methods Form -->
                            <form method="POST" action="/shop/checkout/shipping" class="tts-shipping-form" id="shipping-form">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                                <h2 class="tts-shipping-title">Shipping</h2>

                                <!-- Shipping Methods Grid -->
                                <div class="tts-shipping-methods">
                                    <t t-foreach="carriers" t-as="carrier">
                                        <div class="tts-shipping-method" t-att-data-selected="'true' if website_sale_order.carrier_id and carrier.id == website_sale_order.carrier_id.id else 'false'">
                                            <label class="tts-shipping-method-label">
                                                <!-- Carrier Icon -->
                                                <div class="tts-carrier-icon">
                                                    <t t-if="carrier.name.lower().find('dhl') != -1">
                                                        <div class="tts-carrier-logo tts-carrier-dhl">
                                                            <div class="tts-dhl-stripe"></div>
                                                        </div>
                                                    </t>
                                                    <t t-elif="carrier.name.lower().find('fedex') != -1">
                                                        <div class="tts-carrier-logo tts-carrier-fedex">
                                                            <div class="tts-fedex-purple"></div>
                                                            <div class="tts-fedex-orange"></div>
                                                        </div>
                                                    </t>
                                                    <t t-elif="carrier.name.lower().find('ups') != -1">
                                                        <div class="tts-carrier-logo tts-carrier-ups">
                                                            <div class="tts-ups-shield"></div>
                                                        </div>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="tts-carrier-logo tts-carrier-generic">
                                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                <path d="M12 3L6 9H9V18H15V9H18L12 3Z" stroke="currentColor" stroke-width="1.5"/>
                                                            </svg>
                                                        </div>
                                                    </t>
                                                </div>

                                                <!-- Carrier Info -->
                                                <div class="tts-carrier-info">
                                                    <div class="tts-carrier-name" t-esc="carrier.name"/>
                                                    <div class="tts-carrier-price">
                                                        <t t-if="carrier.fixed_price">
                                                            <span t-field="carrier.fixed_price" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}"/>
                                                        </t>
                                                        <t t-else="">
                                                            Free
                                                        </t>
                                                    </div>
                                                </div>

                                                <!-- Radio Button -->
                                                <input type="radio"
                                                       name="carrier_id"
                                                       t-att-value="carrier.id"
                                                       class="tts-shipping-radio"
                                                       t-att-checked="'checked' if website_sale_order.carrier_id and carrier.id == website_sale_order.carrier_id.id else None"/>
                                                <div class="tts-radio-custom"></div>
                                            </label>
                                        </div>
                                    </t>
                                </div>

                                <!-- Next Step Button -->
                                <div class="tts-shipping-button-wrapper">
                                    <button type="submit" class="tts-shipping-button">Continue to Payment</button>
                                </div>
                            </form>

                        </div>
                    </t>

                    <!-- ===============================================================
                         STEP 3: PAYMENT
                         =============================================================== -->
                    <t t-elif="current_step == 'payment'">
                        <div class="tts-checkout-payment">
                            <!-- Address + Shipping Summary Cards -->
                            <div class="tts-checkout-payment-wrapper mb-4">
                                <!-- Address Summary Card -->
                                <div class="tts-summary-card">
                                    <div class="tts-summary-card-header">
                                        <h3 class="tts-summary-card-title">Address</h3>
                                        <a href="/shop/checkout?step=address" class="tts-summary-edit-link">
                                            <span>edit</span>
                                            <svg class="tts-icon-edit" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                <path d="M11.3333 2L14 4.66667L5.33333 13.3333H2.66667V10.6667L11.3333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </a>
                                    </div>
                                    <div class="tts-summary-card-content">
                                        <div class="tts-summary-column">
                                            <h4 class="tts-summary-column-title">Billing Address</h4>
                                            <div class="tts-summary-text">
                                                <t t-if="website_sale_order and website_sale_order.partner_id">
                                                    <t t-if="website_sale_order.partner_id.company_name">
                                                        <t t-esc="website_sale_order.partner_id.company_name"/><br/>
                                                    </t>
                                                    <t t-esc="website_sale_order.partner_id.name"/><br/>
                                                    <t t-esc="website_sale_order.partner_id.street"/><br/>
                                                    <t t-if="website_sale_order.partner_id.street2">
                                                        <t t-esc="website_sale_order.partner_id.street2"/><br/>
                                                    </t>
                                                    <t t-esc="website_sale_order.partner_id.zip"/> <t t-esc="website_sale_order.partner_id.city"/>
                                                </t>
                                            </div>
                                        </div>
                                        <div class="tts-summary-column">
                                            <h4 class="tts-summary-column-title">Shipping Address</h4>
                                            <div class="tts-summary-text">
                                                <t t-if="website_sale_order and website_sale_order.partner_shipping_id">
                                                    <t t-if="website_sale_order.partner_shipping_id.id != website_sale_order.partner_id.id">
                                                        <t t-if="website_sale_order.partner_shipping_id.company_name">
                                                            <t t-esc="website_sale_order.partner_shipping_id.company_name"/><br/>
                                                        </t>
                                                        <t t-esc="website_sale_order.partner_shipping_id.name"/><br/>
                                                        <t t-esc="website_sale_order.partner_shipping_id.street"/><br/>
                                                        <t t-if="website_sale_order.partner_shipping_id.street2">
                                                            <t t-esc="website_sale_order.partner_shipping_id.street2"/><br/>
                                                        </t>
                                                        <t t-esc="website_sale_order.partner_shipping_id.zip"/> <t t-esc="website_sale_order.partner_shipping_id.city"/>
                                                    </t>
                                                    <t t-else="">
                                                        Same as billing address
                                                    </t>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Shipping Summary Card -->
                                <div class="tts-summary-card">
                                    <div class="tts-summary-card-header">
                                        <h3 class="tts-summary-card-title">Shipping</h3>
                                        <a href="/shop/checkout?step=shipping" class="tts-summary-edit-link">
                                            <span>edit</span>
                                            <svg class="tts-icon-edit" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                <path d="M11.3333 2L14 4.66667L5.33333 13.3333H2.66667V10.6667L11.3333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </a>
                                    </div>
                                    <div class="tts-summary-card-content">
                                        <div class="tts-summary-column">
                                            <h4 class="tts-summary-column-title" t-if="website_sale_order and website_sale_order.carrier_id" t-esc="website_sale_order.carrier_id.name"/>
                                            <h4 class="tts-summary-column-title" t-else="">No shipping method selected</h4>
                                            <div class="tts-summary-text" t-if="website_sale_order and website_sale_order.carrier_id">
                                                Delivery time: 1 week
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Form -->
                            <form method="POST" action="/shop/checkout/payment" class="tts-checkout-payment-form o_payment_form" id="o_payment_form">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                                <h2 class="tts-checkout-payment-title">Payment</h2>

                                <!-- Payment Methods -->
                                <div class="tts-checkout-payment-methods">
                                    <t t-if="payment_methods_sudo">
                                        <t t-foreach="payment_methods_sudo" t-as="method">
                                            <div class="tts-checkout-payment-method o_payment_option_card">
                                                <!-- Halftone shadow effect (matching payment_methods.xml design) -->
                                                <div class="tts-checkout-payment-method-shadow"></div>

                                                <!-- Payment method content card -->
                                                <div class="tts-checkout-payment-method-content">
                                                    <label class="tts-checkout-payment-method-header">
                                                        <!-- Payment Icon -->
                                                        <div class="tts-checkout-payment-icon">
                                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                                <path d="M16.27 5.83H3.73C3.08 5.83 2.5 6.27 2.5 6.92V13.08C2.5 13.73 3.08 14.17 3.73 14.17H16.27C16.92 14.17 17.5 13.73 17.5 13.08V6.92C17.5 6.27 16.92 5.83 16.27 5.83Z" stroke="currentColor" stroke-width="1.93"/>
                                                            </svg>
                                                        </div>

                                                        <!-- Payment Method Name -->
                                                        <span class="tts-checkout-payment-method-name" t-esc="method.name"/>

                                                        <!-- Radio Button (correct field name for Odoo 18) -->
                                                        <input type="radio"
                                                               name="payment_method_id"
                                                               t-att-value="method.id"
                                                               class="tts-checkout-payment-radio o_payment_radio"
                                                               t-att-checked="'checked' if method_index == 0 else None"/>
                                                        <div class="tts-checkout-radio-custom"></div>
                                                    </label>
                                                </div>
                                            </div>
                                        </t>
                                    </t>

                                    <!-- Fallback if no payment methods available -->
                                    <div t-if="not payment_methods_sudo" class="alert alert-warning">
                                        No payment methods available. Please contact support.
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="tts-checkout-payment-button-wrapper">
                                    <div class="tts-checkout-button-shadow"></div>
                                    <button type="submit" class="tts-checkout-payment-button o_payment_submit_button">Continue to Notes</button>
                                </div>
                            </form>
                        </div>
                    </t>

                    <!-- ===============================================================
                         STEP 4: NOTES (Order Note + Final Confirmation)
                         =============================================================== -->
                    <t t-elif="current_step == 'notes'">
                        <div class="tts-checkout-notes">
                            <!-- Address Summary Card -->
                            <div class="tts-summary-card">
                                <div class="tts-summary-card-header">
                                    <h3 class="tts-summary-card-title">Address</h3>
                                    <a href="/shop/checkout?step=address" class="tts-summary-edit-link">
                                        <span>edit</span>
                                        <svg class="tts-icon-edit" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <path d="M11.3333 2L14 4.66667L5.33333 13.3333H2.66667V10.6667L11.3333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                </div>
                                <div class="tts-summary-card-content">
                                    <div class="tts-summary-column">
                                        <h4 class="tts-summary-column-title">Billing Address</h4>
                                        <div class="tts-summary-text">
                                            <t t-if="website_sale_order and website_sale_order.partner_id">
                                                <t t-if="website_sale_order.partner_id.company_name">
                                                    <t t-esc="website_sale_order.partner_id.company_name"/><br/>
                                                </t>
                                                <t t-esc="website_sale_order.partner_id.name"/><br/>
                                                <t t-esc="website_sale_order.partner_id.street"/><br/>
                                                <t t-if="website_sale_order.partner_id.street2">
                                                    <t t-esc="website_sale_order.partner_id.street2"/><br/>
                                                </t>
                                                <t t-esc="website_sale_order.partner_id.zip"/> <t t-esc="website_sale_order.partner_id.city"/>
                                            </t>
                                        </div>
                                    </div>
                                    <div class="tts-summary-column">
                                        <h4 class="tts-summary-column-title">Shipping Address</h4>
                                        <div class="tts-summary-text">
                                            <t t-if="website_sale_order and website_sale_order.partner_shipping_id">
                                                <t t-if="website_sale_order.partner_shipping_id.id != website_sale_order.partner_id.id">
                                                    <t t-if="website_sale_order.partner_shipping_id.company_name">
                                                        <t t-esc="website_sale_order.partner_shipping_id.company_name"/><br/>
                                                    </t>
                                                    <t t-esc="website_sale_order.partner_shipping_id.name"/><br/>
                                                    <t t-esc="website_sale_order.partner_shipping_id.street"/><br/>
                                                    <t t-if="website_sale_order.partner_shipping_id.street2">
                                                        <t t-esc="website_sale_order.partner_shipping_id.street2"/><br/>
                                                    </t>
                                                    <t t-esc="website_sale_order.partner_shipping_id.zip"/> <t t-esc="website_sale_order.partner_shipping_id.city"/>
                                                </t>
                                                <t t-else="">
                                                    Same as billing address
                                                </t>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Shipping Summary Card -->
                            <div class="tts-summary-card">
                                <div class="tts-summary-card-header">
                                    <h3 class="tts-summary-card-title">Shipping</h3>
                                    <a href="/shop/checkout?step=shipping" class="tts-summary-edit-link">
                                        <span>edit</span>
                                        <svg class="tts-icon-edit" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <path d="M11.3333 2L14 4.66667L5.33333 13.3333H2.66667V10.6667L11.3333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                </div>
                                <div class="tts-summary-card-content">
                                    <div class="tts-summary-column">
                                        <h4 class="tts-summary-column-title" t-if="website_sale_order and website_sale_order.carrier_id" t-esc="website_sale_order.carrier_id.name"/>
                                        <h4 class="tts-summary-column-title" t-else="">No shipping method selected</h4>
                                        <div class="tts-summary-text" t-if="website_sale_order and website_sale_order.carrier_id">
                                            Delivery time: 1 week
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Summary Card -->
                            <div class="tts-summary-card">
                                <div class="tts-summary-card-header">
                                    <h3 class="tts-summary-card-title">Payment</h3>
                                    <a href="/shop/payment" class="tts-summary-edit-link">
                                        <span>edit</span>
                                        <svg class="tts-icon-edit" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                            <path d="M11.3333 2L14 4.66667L5.33333 13.3333H2.66667V10.6667L11.3333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                </div>
                                <div class="tts-summary-card-content">
                                    <div class="tts-summary-column">
                                        <h4 class="tts-summary-column-title" t-if="selected_payment_method" t-esc="selected_payment_method.name"/>
                                        <h4 class="tts-summary-column-title" t-else="">No payment method selected</h4>
                                        <div class="tts-summary-text" t-if="selected_payment_method">
                                            Once you confirmed your order, you will be redirected to complete your payment.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Note Form -->
                            <form method="POST" action="/shop/checkout/notes" class="tts-notes-form" id="notes-form">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                                <h2 class="tts-notes-title">Order Note</h2>

                                <!-- Order Note Textarea -->
                                <div class="tts-notes-form-group">
                                    <label class="tts-notes-label">
                                        <span class="tts-notes-label-optional">Optional</span>
                                    </label>
                                    <div class="tts-notes-textarea-wrapper">
                                        <textarea id="order_note"
                                                  name="order_note"
                                                  class="tts-notes-textarea"
                                                  placeholder="Add any special instructions or notes for your order"
                                                  rows="5"
                                                  t-att-value="website_sale_order.note or ''"></textarea>
                                    </div>
                                </div>

                                <!-- Privacy Notice -->
                                <div class="tts-notes-privacy">
                                    <p class="tts-notes-privacy-text">
                                        Your information will be treated confidentially and used exclusively for the purpose of processing your request. The data transmission is encrypted. Further information on data protection can be found in our
                                        <a href="/privacy-policy" class="tts-notes-privacy-link">Privacy Policy</a>.
                                    </p>
                                </div>

                                <!-- Terms and Conditions Checkbox -->
                                <div class="tts-notes-terms">
                                    <label class="tts-notes-checkbox-label" onclick="toggleTermsCheckbox()">
                                        <input type="checkbox"
                                               id="terms_accepted"
                                               name="terms_accepted"
                                               value="1"
                                               class="tts-checkbox"
                                               required="required"
                                               onclick="toggleTermsCheckbox()"/>
                                        <img id="termsCheckboxIcon"
                                             class="tts-checkbox-icon"
                                             src="/custom_shop_templates/static/src/img/icons/checkbox.svg"
                                             alt="Checkbox"/>
                                        <span class="tts-checkbox-text">
                                            With your order, you agree to have read and understood our
                                            <a href="/terms-and-conditions" class="tts-notes-terms-link" target="_blank">Terms and Conditions</a>,
                                            your <a href="/right-of-recission" class="tts-notes-terms-link" target="_blank">Right of Recission</a>
                                            and our <a href="/privacy-policy" class="tts-notes-terms-link" target="_blank">Privacy Policy</a>.
                                        </span>
                                    </label>
                                </div>

                                <!-- Submit Button -->
                                <div class="tts-notes-button-wrapper">
                                    <button type="submit" class="tts-notes-button">Buy now</button>
                                </div>
                            </form>

                            <script type="text/javascript">
                                // Toggle terms checkbox icon
                                function toggleTermsCheckbox() {
                                    const checkbox = document.getElementById('terms_accepted');
                                    const checkboxIcon = document.getElementById('termsCheckboxIcon');

                                    if (checkbox.checked) {
                                        checkboxIcon.src = '/custom_shop_templates/static/src/img/icons/checkbox-checked.svg';
                                    } else {
                                        checkboxIcon.src = '/custom_shop_templates/static/src/img/icons/checkbox.svg';
                                    }
                                }

                                // Initialize on page load
                                document.addEventListener('DOMContentLoaded', function() {
                                    toggleTermsCheckbox();
                                });
                            </script>
                        </div>
                    </t>

                </div>  <!-- End #shop_checkout -->
            </xpath>
        </template>
    </data>
</odoo>
